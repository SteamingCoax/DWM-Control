<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';">
    <title>DWM Control</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- App Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="app-logo">
                    <span class="logo-icon">‚ö°</span>
                    <div class="logo-text">
                        <h1>DWM Control</h1>
                        <p>Device Firmware Manager</p>
                    </div>
                </div>
                        <div class="header-status">
            <!-- Update Status -->
            <div id="update-panel" class="update-panel" style="display: none;">
                <button id="update-button" class="update-btn">
                    <span class="update-icon">üîÑ</span>
                    <span class="update-text">Update Available</span>
                </button>
            </div>
            
            <!-- Serial Connection Status/Panel -->
            <div class="connection-panel">
                <button id="connection-toggle" class="connection-status-btn">
                    <div class="connection-indicator">
                        <div class="connection-dot" id="connection-dot"></div>
                        <span class="connection-text" id="connection-text">Disconnected</span>
                        <span class="connection-expand">‚ñº</span>
                    </div>
                </button>
                
                <!-- Collapsible Connection Controls -->
                <div class="connection-dropdown" id="connection-dropdown">
                    <div class="connection-controls">
                        <div class="connection-header">
                            <h4>Serial Communication Setup</h4>
                        </div>
                        <div class="connection-row">
                            <label for="header-port-select">Port:</label>
                            <div class="connection-input-group">
                                <select id="header-port-select" class="connection-select">
                                    <option>Select port...</option>
                                </select>
                                <button id="header-refresh-ports-btn" class="connection-btn" title="Refresh Ports">
                                    üîÑ
                                </button>
                            </div>
                        </div>
                        <div class="connection-actions-header">
                            <button id="header-connect-btn" class="connection-action-btn connect">
                                <span class="btn-icon">üîó</span> Connect
                            </button>
                            <button id="header-disconnect-btn" class="connection-action-btn disconnect" disabled>
                                <span class="btn-icon">üîå</span> Disconnect
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="theme-toggle" class="btn btn-text" title="Toggle Dark Mode">
                <span class="btn-icon">üåô</span>
            </button>
        </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="tab-navigation">
            <button class="tab-button active" data-tab="firmware">
                <span class="tab-icon">üîß</span>
                <span class="tab-label">Firmware Upload</span>
            </button>
            <button class="tab-button" data-tab="terminal">
                <span class="tab-icon">üíª</span>
                <span class="tab-label">Serial Terminal</span>
            </button>
            <button class="tab-button" data-tab="control">
                <span class="tab-icon">üéõÔ∏è</span>
                <span class="tab-label">Control</span>
            </button>
            <button class="tab-button" data-tab="deembed">
                <span class="tab-icon">üìä</span>
                <span class="tab-label">De-Embed</span>
            </button>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Firmware Upload Tab -->
            <section id="firmware-panel" class="tab-panel active">
                <div class="panel-container">
                    <!-- Device Selection Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3><span class="card-icon">üì°</span>Device Selection</h3>
                            <p class="card-subtitle">Connect and select your DFU device</p>
                        </div>
                        <div class="card-content">
                            <div class="form-group">
                                <label for="device-combo">Available DFU Devices:</label>
                                <div class="input-group">
                                    <select id="device-combo" class="form-select">
                                        <option>Click 'Refresh' to scan for devices</option>
                                    </select>
                                    <button id="refresh-devices-btn" class="btn btn-primary">
                                        <span class="btn-icon">üîÑ</span>
                                        Refresh
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Firmware File Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3><span class="card-icon">üìÅ</span>Firmware File</h3>
                            <p class="card-subtitle">Select the firmware (.hex) file to upload</p>
                        </div>
                        <div class="card-content">
                            <div class="firmware-options">
                                <button id="download-latest-btn" class="btn btn-primary btn-large">
                                    <span class="btn-icon">‚¨áÔ∏è</span>
                                    Download Latest Firmware
                                </button>
                                <div class="option-divider">
                                    <span>or</span>
                                </div>
                            </div>
                            <div class="file-upload-area" id="file-upload-area">
                                <div class="upload-content">
                                    <span class="upload-icon">üìÇ</span>
                                    <button id="select-file-btn" class="btn btn-secondary btn-large">
                                        Choose Local File
                                    </button>
                                    <p class="upload-hint">or drag and drop a .hex file here</p>
                                </div>
                                <div class="file-info" id="file-info" style="display: none;">
                                    <div class="file-details">
                                        <span class="file-icon">üìÑ</span>
                                        <div class="file-text">
                                            <span class="file-name" id="file-name">filename.hex</span>
                                            <span class="file-size" id="file-size">0 KB</span>
                                        </div>
                                        <button class="btn btn-text" id="clear-file-btn">‚úï</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Upload Action Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3><span class="card-icon">‚ö°</span>Upload Firmware</h3>
                            <p class="card-subtitle">Flash the firmware to your device</p>
                        </div>
                        <div class="card-content">
                            <div class="upload-actions">
                                <button id="upload-btn" class="btn btn-success btn-large" disabled>
                                    <span class="btn-icon">üöÄ</span>
                                    Upload Firmware
                                </button>
                                <div class="upload-progress" id="upload-progress" style="display: none;">
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="progress-fill"></div>
                                    </div>
                                    <span class="progress-text" id="progress-text">Ready to upload</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Upload Output Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3><span class="card-icon">üìü</span>Upload Output</h3>
                            <p class="card-subtitle"></p>
                            <div class="card-actions">
                                <button id="clear-serial-monitor-btn" class="btn btn-text">
                                    <span class="btn-icon">üóëÔ∏è</span>
                                    Clear
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="serial-monitor-container">
                                <div id="serial-monitor-output" class="serial-monitor-output"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <!-- Serial Terminal Tab -->
            <section id="terminal-panel" class="tab-panel">
                <div class="panel-container">
                    <!-- Terminal Card -->
                    <div class="card card-expanded">
                        <div class="card-header">
                            <h3><span class="card-icon">ÔøΩ</span>Serial Terminal</h3>
                            <p class="card-subtitle">Direct communication with your device</p>
                            <div class="card-actions">
                                <button id="clear-terminal-btn" class="btn btn-text">
                                    <span class="btn-icon">ÔøΩÔ∏è</span>
                                    Clear
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="terminal-container">
                                <div id="terminal-output" class="terminal-output"></div>
                                <div class="terminal-input-area">
                                    <div class="input-group">
                                        <input type="text" id="terminal-input" class="form-input terminal-input" 
                                               placeholder="Type command and press Enter..." disabled>
                                        <button id="send-btn" class="btn btn-primary" disabled>
                                            <span class="btn-icon">üì§</span>
                                            Send
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Device Control Tab -->
            <section id="control-panel" class="tab-panel">
                <div class="panel-container">
                    <!-- Device controls will be dynamically generated here -->
                </div>
            </section>

            <!-- De-Embed Tab -->
            <section id="deembed-panel" class="tab-panel">
                <div class="panel-container">
                    <!-- De-Embed Configuration Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3><span class="card-icon">üìä</span>De-Embedding Configuration</h3>
                        </div>
                        <div class="card-content">
                            <!-- Primary Configuration -->
                            <div class="deembed-primary-config">
                                <h4>Element Configuration</h4>
                                <div class="primary-config-grid">
                                    <div class="config-group">
                                        <label for="power-rating-input">Element Power Rating:</label>
                                        <div class="power-rating-input-group">
                                            <input type="number" 
                                                   id="power-rating-input" 
                                                   class="power-rating-input" 
                                                   placeholder="Enter power rating" 
                                                   step="any"
                                                   min="0.001">
                                            <span id="power-rating-unit" class="power-unit-display">W</span>
                                        </div>
                                    </div>
                                    
                                    <div class="config-group">
                                        <label for="power-units-select">Power Units:</label>
                                        <select id="power-units-select" class="form-select">
                                            <option value="mW">mW (milliwatts)</option>
                                            <option value="W" selected>W (watts)</option>
                                            <option value="kW">kW (kilowatts)</option>
                                            <option value="MW">MW (megawatts)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Measurement Configuration -->
                            <div class="deembed-measurement-config">
                                <h4>Measurement Configuration</h4>
                                <div class="measurement-config-grid">
                                    <div class="config-group">
                                        <label for="data-points-select">Number of Data Points:</label>
                                        <select id="data-points-select" class="form-select">
                                            <option value="5">5 Points</option>
                                            <option value="10">10 Points</option>
                                        </select>
                                    </div>
                                    
                                    <div class="config-group" style="display: none;">
                                        <label for="voltage-input-mode">Voltage Input Method:</label>
                                        <select id="voltage-input-mode" class="form-select">
                                            <option value="sample">Sample from Meter</option>
                                            <option value="manual" selected>Manual Entry</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Data Entry Fields -->
                            <div class="deembed-data-section">
                                <h4>Power Level and Voltage Measurements</h4>
                                <div id="data-entry-container" class="data-entry-container">
                                    <!-- Data entry rows will be dynamically generated -->
                                </div>
                            </div>

                            <!-- Compute Button -->
                            <div class="compute-section">
                                <button id="compute-btn" class="btn btn-primary btn-large">
                                    <span class="btn-icon">üßÆ</span>
                                    Compute Polynomial Fit
                                </button>
                            </div>

                            <!-- Results Display -->
                            <div id="results-section" class="results-section" style="display: none;">
                                <h4>De-Embedding Result</h4>
                                <div class="coefficients-display">
                                    <div class="coefficient-item">
                                        <label>COEF 1:</label>
                                        <span id="coef1-value" class="coefficient-value">-</span>
                                    </div>
                                    <div class="coefficient-item">
                                        <label>COEF 2:</label>
                                        <span id="coef2-value" class="coefficient-value">-</span>
                                    </div>
                                    <div class="coefficient-item">
                                        <label>COEF 3:</label>
                                        <span id="coef3-value" class="coefficient-value">-</span>
                                    </div>
                                </div>
                                <div class="fit-quality">
                                    <label>Quality of Measurement:</label>
                                    <span id="r-squared-value" class="coefficient-value">-</span>
                                </div>
                                
                                <!-- Upload Section -->
                                <div id="upload-section" class="upload-section">
                                    <h5>Upload to Element</h5>
                                    <div class="upload-controls">
                                        <div class="form-group">
                                            <label for="element-slot-select">Element Slot:</label>
                                            <select id="element-slot-select" class="form-select">
                                                <option value="1">Slot 1</option>
                                                <option value="2">Slot 2</option>
                                                <option value="3">Slot 3</option>
                                                <option value="4">Slot 4</option>
                                                <option value="5">Slot 5</option>
                                                <option value="6">Slot 6</option>
                                                <option value="7">Slot 7</option>
                                                <option value="8">Slot 8</option>
                                            </select>
                                        </div>
                                        <button id="upload-coefficients-btn" class="btn btn-success">
                                            <span class="btn-icon">üì§</span>
                                            Upload Coefficients
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Output Console (Global) -->
        <aside id="output-section" class="console-sidebar">
            <div class="console-header">
                <h4><span class="console-icon">üìã</span>Output Console</h4>
                <div class="console-actions">
                    <button id="toggle-output-btn" class="btn btn-text">
                        <span class="btn-icon">üôà</span> Hide Output
                    </button>
                    <button id="clear-console-btn" class="btn btn-text">
                        <span class="btn-icon">üóëÔ∏è</span>
                        Clear
                    </button>
                </div>
            </div>
            <div id="output-console" class="console-content"></div>
        </aside>
    </div>

    <script src="renderer.js"></script>
</body>
</html>
